@app.route('/register/verify', methods=['GET', 'POST'])
def register_verify():
    print("=" * 80)
    print("DEBUG: Начало register_verify")
    print(f"DEBUG: Метод запроса: {request.method}")
    print(f"DEBUG: Сессия: {dict(session)}")
    print("=" * 80)
    
    if 'reg_email' not in session:
        flash('Сначала введите email', 'error')
        return redirect('/register')
    
    if request.method == 'POST':
        entered_code = request.form.get('confirm_code', '').strip()
        print(f"DEBUG: Введен код: {entered_code}")
        print(f"DEBUG: Ожидается код: {session.get('confirm_code')}")
        
        if entered_code == session.get('confirm_code'):
            session['email_verified'] = True
            print("DEBUG: Код верный, переходим к details")
            return redirect('/register/details')
        else:
            flash('Неверный код подтверждения', 'error')
    
    # Пробуем рендерить простейший шаблон
    try:
        print(f"DEBUG: Пробуем рендерить шаблон для email: {session.get('reg_email')}")
        return render_template('regist/verify.html', email=session.get('reg_email'))
    except Exception as e:
        print(f"❌ ОШИБКА РЕНДЕРИНГА: {e}")
        # Возвращаем простой HTML для теста
        return f'''
        <!DOCTYPE html>
        <html>
        <head><title>Тест</title></head>
        <body>
            <h1>Тестовый шаблон работает!</h1>
            <p>Email: {session.get('reg_email')}</p>
            <form method="POST">
                <input type="text" name="confirm_code" placeholder="Код">
                <button type="submit">Подтвердить</button>
            </form>
        </body>
        </html>
        '''